<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    {% load static %}
    <link rel='stylesheet' type='text/css' href="{% static 'result.css' %}">
</head>
<body>
{% include "navbar.html" %}
<div class="justify-between">
<div></div>
<audio  controls>
    <source type="audio/wav">
    <source src="{% static 'test.mp3' %}" type="audio/mpeg">
    이 문장은 여러분의 브라우저가 audio 태그를 지원하지 않을 때 화면에 표시됩니다!
</audio>
<button id="downloadBtn">음원 다운로드</button>
<div></div>
</div>

<div class="center">
<video controls id="myVideo" ontimeupdate ="getCurVideoTime()">
  <source src="{% static 'test.mp4' %}" type="video/mp4">
</video>

<div class="content">
</div>
<div id='spectrum'>
<div id="videoLocator"></div>
{% comment %} <div style="background-color:red"></div>
<div style="background-color:blue"></div>
<div style="background-color:black"></div>
<div style="background-color:orange"></div>
<div style="background-color:cyan"></div> {% endcomment %}
</div>    
<div id="labelBox">
<div class="label">
<div class="Anger"></div>
<label>Anger</label>
</div>
<div class="label">
<div class="Sad"></div>
<label>Sad</label>
</div>
<div class="label">
<div class="Disgust"></div>
<label>Disgust</label>
</div>
<div class="label">
<div class="Neutral"></div>
<label>Neutral</label>
</div>
<div class="label">
<div class="Fear"></div>
<label>Fear</label>
</div>
<div class="label">
<div class="Surprise"></div>
<label>Surprise</label>
</div>
<div class="label">
<div class="Happy"></div>
<label>Happy</label>
</div>

</div>
</div>

<input id="data" type="text" value="{{emotion}}" style="display:none;"/>
</body>
</html>


<script>
    let spectrum = document.getElementById('spectrum')
    let data = document.getElementById('data');
    let arr = {{emotion}}
    console.log(arr)
    let emotionSpectrum = ''
    for(let i = 0 ; i < arr.length - 12 ; i+=10){
        let emotionColor = {'Anger' : 0, 'Disgust' : 0,'Fear' :0,'Happy' :0,'Neutral' : 0,'Sad' : 0, 'Surprise': 0}
        for(let j = 0 ; j < 10 ; j++ ){
            emotionColor[arr[i+j][1]]++;
        }
        let max = 0;
        let maxEmotion = 0;
        for(let j in emotionColor){
            if(emotionColor[j] > max){
                max = emotionColor[j];
                maxEmotion = j;
            }
        }
        let color = maxEmotion
        emotionSpectrum += "<div class=\""+ color+"   \"></div>"
    }
    spectrum.innerHTML += emotionSpectrum;

    let video = document.getElementById('myVideo');
    let videoLoc = document.getElementById('videoLocator');
function getCurVideoTime(){
    videoLoc.style.left = (video.currentTime/video.duration*100) + "%"
}
spectrum.onclick = function(e){
    video.currentTime = (e.layerX / spectrum.offsetWidth ) * video.duration 
}
</script>